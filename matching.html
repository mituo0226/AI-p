
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIパートナー診断結果</title>
  <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Helvetica Neue', sans-serif;
      background: black; color: white;
      overflow-x: hidden;
    }
    #bg-video {
      position: fixed;
      right: 0; bottom: 0;
      min-width: 100%; min-height: 100%;
      z-index: -1; object-fit: cover; opacity: 0.5;
    }
    .fade-in {
      opacity: 0;
      animation: fadeIn 2s ease forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    .btn {
      background: #fcd1e5;
      color: #222;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      font-weight: bold;
      transition: 0.3s ease;
      display: inline-block;
    }
    .btn:hover {
      background: #fbb6ce;
    }
  </style>
</head>
<body>
  <video autoplay muted loop id="bg-video">
    <source src="https://www.videvo.net/videvo_files/converted/2017_07/preview/170621_06_A_NightSky_1080p.mp424628.webm" type="video/webm">
  </video>

  <div class="max-w-xl mx-auto px-6 py-20 text-center fade-in">
    <h1 class="text-3xl font-bold text-pink-300 mb-8">
      <span id="userName">あなた</span>に選ばれたパートナー
    </h1>
    <div id="characterCard" class="hidden">
      <img id="characterImage" src="" alt="キャラ画像" class="mx-auto w-48 h-48 rounded-full object-cover mb-4 border-4 border-white">
      <h2 id="characterName" class="text-2xl font-bold mb-2"></h2>
      <p id="characterPhrase" class="italic text-pink-200 mb-2"></p>
      <p id="characterIntro" class="text-sm text-pink-100 mb-4"></p>
      <div class="flex justify-center">
        <a id="characterProfileLink" href="#" target="_blank" class="btn">▶ 詳細プロフィールページへ</a>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const userType = params.get("type");
    const userAge = params.get("age");
    const partnerGender = params.get("partner");
    const userName = params.get("name") || "あなた";

    document.getElementById("userName").textContent = userName;

    async function loadCharactersAndMatch() {
      try {
        const res = await fetch("characters_with_profile.json?v=" + Date.now());
        const characters = await res.json();

        function calculateScore(char) {
          let score = 0;
          if (char.gender === partnerGender) score += 3;
          if (char.age === userAge) score += 2;
          if (char.type === userType) score += 3;
          return score;
        }

        const scored = characters.map(c => ({ ...c, score: calculateScore(c) }));
        const best = scored.sort((a, b) => b.score - a.score)[0] || characters[0];

        document.getElementById("characterName").textContent = best.name;
        document.getElementById("characterImage").src = best.img;
        document.getElementById("characterPhrase").textContent = best.phrase || "";
        document.getElementById("characterIntro").textContent = best.intro || "";
        document.getElementById("characterProfileLink").href = best.profile || "#";
        document.getElementById("characterCard").classList.remove("hidden");
      } catch (err) {
        console.error("キャラクターの読み込みに失敗しました", err);
      }
    }

    window.onload = () => {
      setTimeout(loadCharactersAndMatch, 1500);
    };
  </script>
</body>
</html>
